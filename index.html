<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨Ø·Ø§Ù‚Ø© ØªÙ‡Ù†Ø¦Ø©</title>

<style>
  body{
    margin:0;
    font-family: Arial, "Segoe UI", system-ui;
    background:#f4f4f4;
  }

  .wrap{ max-width:900px; margin:30px auto; padding:15px; }

  .card{
    background:#fff;
    padding:20px;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
  }

  .row{
    display:flex;
    gap:10px;
    align-items:end;
    flex-wrap:wrap;
  }

  label{ font-weight:bold; margin-bottom:6px; display:block; }

  input{
    padding:12px 14px;
    border-radius:10px;
    border:1px solid #ddd;
    min-width:320px;
    font-size:16px;
  }

  small{
    display:block;
    margin-top:6px;
    color:#777;
  }

  button{
    padding:12px 18px;
    border-radius:10px;
    border:0;
    font-weight:bold;
    cursor:pointer;
  }

  .primary{ background:#6b0f1a; color:#fff; }
  .ghost{ background:#eee; color:#6b0f1a; }

  canvas{
    width:100%;
    max-height:70vh;       /* ØªØµØºÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· */
    object-fit:contain;    /* Ø¨Ø¯ÙˆÙ† stretch */
    margin-top:20px;
    border-radius:16px;
  }

  /* Ø®Ø· GE SS */
  @font-face{
    font-family:"GE_SS";
    src:url("GE-SS-Two-Bold.otf") format("opentype");
    font-weight:bold;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="row">
      <div>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
        <input id="name" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§" />
        <small>ÙŠÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ø£Ø¬Ù…Ù„</small>
      </div>

      <button class="primary" id="gen">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
      <button class="ghost" id="dl" disabled>ØªØ­Ù…ÙŠÙ„</button>
    </div>

    <canvas id="c"></canvas>

  </div>
</div>

<script>
  const NAME_COLOR = "#7daab3";

  // (Ù„Ø§ Ù†ØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨ØªÙŠ)
  const BASE_FONT_SIZE = 190;
  const MIN_FONT_SIZE  = 70;

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const nameInput = document.getElementById("name");
  const genBtn = document.getElementById("gen");
  const dlBtn = document.getElementById("dl");

  let lastUrl = null;

  function fitFont(text, maxWidth){
    let size = BASE_FONT_SIZE;
    while(size > MIN_FONT_SIZE){
      ctx.font = `bold ${size}px GE_SS`;
      if(ctx.measureText(text).width <= maxWidth) return size;
      size -= 2;
    }
    return MIN_FONT_SIZE;
  }

  function generate(){
    const name = nameInput.value.trim();
    if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…");

    const img = new Image();
    img.src = "template.png";

    img.onload = () => {
      canvas.width  = img.naturalWidth;
      canvas.height = img.naturalHeight;

      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0);

      /* ============================
         âœ… Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… (Ø¨Ø§Ù„Ù†ÙØ³ÙØ¨)
         Ø¹Ø¯Ù„Ù†Ø§ X ÙŠØ³Ø§Ø± Ø´ÙˆÙŠ Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨ØªÙŠ
         ============================ */

      const BOX_W = canvas.width  * 0.66;     // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„
      const BOX_H = canvas.height * 0.048;    // Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„

      // Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ (Ø§Ù„Ù€ Y Ø«Ø§Ø¨Øª Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©)
      const BOX_CENTER_Y = canvas.height * 0.747;

      // ğŸ‘ˆ Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…: Ø®Ù„ÙŠÙ‡ "ÙŠØ³Ø§Ø±" Ø£ÙƒØ«Ø±
      // ÙƒØ§Ù† ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©ØŒ Ø§Ù„Ø­ÙŠÙ† ÙˆØ¯ÙŠÙ†Ø§Ù‡ ÙŠØ³Ø§Ø± Ø²ÙŠØ§Ø¯Ø©
      const BOX_CENTER_X = (canvas.width * 0.50) - (canvas.width * 0.035);

      const BOX_X = BOX_CENTER_X - (BOX_W/2);
      const BOX_Y = BOX_CENTER_Y - (BOX_H/2);

      // Ù†Ø®Ù„ÙŠ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø¨Ù‡Ø§Ù…Ø´
      const MAX_TEXT_WIDTH = BOX_W * 0.88;

      const fontSize = fitFont(name, MAX_TEXT_WIDTH);

      // âœ… Ù‚Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„: Ù…Ø³ØªØ­ÙŠÙ„ ÙŠØ·Ù„Ø¹ Ø¨Ø±Ø§
      ctx.save();
      ctx.beginPath();
      ctx.rect(BOX_X, BOX_Y, BOX_W, BOX_H);
      ctx.clip();

      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.direction = "rtl";
      ctx.fillStyle = NAME_COLOR;
      ctx.font = `bold ${fontSize}px GE_SS`;

      ctx.shadowColor = "rgba(0,0,0,.15)";
      ctx.shadowBlur = 4;
      ctx.shadowOffsetY = 2;

      // Ø§Ø±Ø³Ù… Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø¨Ø§Ù„Ø¶Ø¨Ø·
      ctx.fillText(name, BOX_CENTER_X, BOX_CENTER_Y);

      ctx.restore();

      lastUrl = canvas.toDataURL("image/png");
      dlBtn.disabled = false;
    };

    img.onerror = () => alert("ØªØ£ÙƒØ¯ÙŠ Ø£Ù† template.png Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.");
  }

  function download(){
    if(!lastUrl) return;
    const a = document.createElement("a");
    a.href = lastUrl;
    a.download = "Ø¨Ø·Ø§Ù‚Ø©.png";
    a.click();
  }

  genBtn.onclick = generate;
  dlBtn.onclick = download;
</script>
</body>
</html>



